#!/bin/bash -eu

readonly THIS=$(realpath "$0")
readonly HERE=$(dirname "$THIS")

read -p "SSH_PUBLIC_KEY_PATH: " SSH_PUBLIC_KEY_PATH
read -p "VAULT_GET_TOKEN_COMMAND: " VAULT_GET_TOKEN_COMMAND
read -p "VAULT_BASE_URL: " VAULT_BASE_URL
read -p "VAULT_SSH_HOST_MOUNT_PATH: " VAULT_SSH_HOST_MOUNT_PATH
read -p "VAULT_SSH_HOST_ROLE_NAME: " VAULT_SSH_HOST_ROLE_NAME
read -p "VAULT_SSH_USER_MOUNT_PATH: " VAULT_SSH_USER_MOUNT_PATH
read -p "VAULT_SSH_USER_ROLE_NAME: " VAULT_SSH_USER_ROLE_NAME

cat <<__EOF__ > ~/.profile.d/cssh
export SSH_PUBLIC_KEY_PATH="${SSH_PUBLIC_KEY_PATH}"
export VAULT_GET_TOKEN_COMMAND="${VAULT_GET_TOKEN_COMMAND}"
export VAULT_BASE_URL="${VAULT_BASE_URL}"
export VAULT_SSH_HOST_MOUNT_PATH="${VAULT_SSH_HOST_MOUNT_PATH}"
export VAULT_SSH_HOST_ROLE_NAME="${VAULT_SSH_HOST_ROLE_NAME}"
export VAULT_SSH_USER_MOUNT_PATH="${VAULT_SSH_USER_MOUNT_PATH}"
export VAULT_SSH_USER_ROLE_NAME="${VAULT_SSH_USER_ROLE_NAME}"
export PATH="$PATH:${HERE}"
__EOF__

source ~/.profile.d/cssh
